<!DOCTYPE html >
<html
	lang="fr"
	xmlns:p="http://primefaces.org/ui"
	xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html">

<h:head>
	<title><ui:insert name="title">
			iSMS
		</ui:insert></title>
	<link
		rel="shortcut icon"
		type="image/png"
		href="#{request.contextPath}/resources/img/iplans_icon.png" />
	<h:outputStylesheet
		library="css"
		name="style.css" />
</h:head>

<h:body>
	<f:view>

		<div id="bloc_page">
			<header>
				<div id="titre_principal">
					<ui:insert name="header">
						<ui:include src="/WEB-INF/new_templates/header.xhtml" />
					</ui:insert>
				</div>
			</header>

			<nav>
				<ui:insert name="menuClient">
					<ui:include src="/WEB-INF/new_templates/menuClient.xhtml" />
				</ui:insert>
			</nav>

			<section>
				<ui:insert name="body">
					<ui:include src="/WEB-INF/new_templates/body.xhtml" />
				</ui:insert>

				<p:idleMonitor
					timeout="900000"
					onidle="PF('alertExpire').show();">
				</p:idleMonitor>

				<p:dialog
					header="Session ExpirÃ©e"
					widgetVar="alertExpire"
					onShow="startIdleMonitor()">
					<h:outputText value="Votre session de navigation expire dans " />
					<h:outputText
						id="dialog-countdown"
						style="font-weight: bold;" />
					<h:outputText value=" secondes." />
					<br />
					<h:outputText value="Continuer la session?" />
					<h:form>
						<p:commandButton
							value="Yes"
							process="@this"
							update="@all"
							onclick="stopCount()" />
						<p:commandButton
							value="No"
							process="@this"
							update="@all"
							action="#{ismsBean.clientDeconnexion()}" />
						<p:remoteCommand
							name="logout"
							action="#{ismsBean.clientDeconnexion()}" />
					</h:form>
					<script type="text/javascript">
		                var TIME = 10; // in seconds
		                var countTimer = TIME;
		                var processTimer;
		                var timer_is_on = 0;
		
		                var countDownDiv = "dialog-countdown";
		                var txtCountDown = null;
		                
		                if (!txtCountDown)
		                    txtCountDown = document.getElementById(countDownDiv);
		
		                function startIdleMonitor() {
		                    countTimer = TIME;
		                    txtCountDown.innerHTML = countTimer;
		                    doTimer();
		                }
		                
		                function timedCount() {
		                    txtCountDown.innerHTML = countTimer;
		                    if (countTimer == 0) {
		                        stopCount();
		                        logout();
		                        return;
		                    }
		                    countTimer = countTimer - 1;
		                    processTimer = setTimeout("timedCount()", 1000);
		                }
		                
		                function doTimer() {
		                    if (!timer_is_on) {
		                        timer_is_on = 1;
		                        timedCount();
		                    }
		                }
		                
		                function stopCount() {
		                    clearTimeout(processTimer);
		                    timer_is_on = 0;
		                }
		            </script>
				</p:dialog>

			</section>

			<footer>
				<ui:insert name="footer">
					<ui:include src="/WEB-INF/new_templates/footer.xhtml" />
				</ui:insert>
			</footer>
		</div>
	</f:view>
</h:body>
</html>